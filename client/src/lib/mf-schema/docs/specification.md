# MediaFranca SVG Schema — Technical Specification

**Version:** 1.0.0
**Status:** Canonical Standard
**Language:** British English
**Licence:** CC BY 4.0

---

## 1. Introduction

### 1.1 Purpose

This document defines the formal requirements for SVG pictograms within the MediaFranca ecosystem. Each SVG file serves as a **Single Source of Truth (SSoT)**, embedding linguistic semantics, accessibility metadata, and human validation data within a portable, platform-independent artefact.

### 1.2 Scope

This specification applies to all SVG pictograms generated by or integrated with the MediaFranca AAC system, including:

- PictoNet-generated pictograms
- Human-authored pictograms following MediaFranca conventions
- Third-party pictogram adaptations (e.g., ARASAAC, Mulberry)

### 1.3 Conformance

An SVG pictogram is **conformant** if and only if:

1. It validates against the XML namespace requirements (§2)
2. It contains a well-formed metadata block validating against `metadata.schema.json` (§3)
3. Its DOM structure follows the semantic hierarchy requirements (§4)
4. It implements the dual-class styling system (§5)
5. It includes mandatory accessibility attributes (§6)

---

## 2. XML Namespaces and Document Structure

### 2.1 Required Namespaces

```xml
<svg
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  viewBox="..."
  role="img"
  aria-labelledby="title desc"
  lang="en">
```

**Mandatory attributes:**

- `xmlns`: SVG 1.1 namespace
- `xmlns:xlink`: For potential future link references
- `viewBox`: Defines the coordinate system (recommended: `0 0 512 512`)
- `role="img"`: ARIA role for assistive technologies
- `aria-labelledby`: References to `<title>` and `<desc>` elements
- `lang`: Language code (ISO 639-1)

### 2.2 Document Order

Elements must appear in the following order:

1. `<title>` — The utterance or communicative intent
2. `<desc>` — Detailed visual description
3. `<metadata>` — The SSoT metadata block
4. `<defs>` — Embedded stylesheet and reusable definitions
5. Semantic groups (`<g>`) — Visual content organised by concept

---

## 3. The Metadata Block

### 3.1 Structure

The metadata block must be a direct child of the `<svg>` root element:

```xml
<metadata id="mf-accessibility">
  {
    "version": "1.0.0",
    "utterance": "...",
    "nsm": { ... },
    "concepts": [ ... ],
    "accessibility": { ... },
    "provenance": { ... },
    "vcsci": { ... }
  }
</metadata>
```

### 3.2 Schema Validation

The JSON content **must** validate against [`../schemas/metadata.schema.json`](../schemas/metadata.schema.json).

### 3.3 Required Fields

#### 3.3.1 `version`

Semantic versioning string (e.g., `"1.0.0"`).

#### 3.3.2 `utterance`

The original communicative intent in natural language.

**Example:** `"I am making the bed"`

#### 3.3.3 `nsm`

Natural Semantic Metalanguage decomposition.

**Required subfields:**
- `primes`: Array of NSM primes (e.g., `["I", "DO", "SOMETHING"]`)
- `gloss`: Human-readable explanation (e.g., `"I DO something to SOMETHING"`)

#### 3.3.4 `concepts`

Array of semantic concepts mapped to SVG groups. Concepts may be **explicit** (with corresponding visual elements) or **implicit** (abstract concepts executed by other entities).

**Each concept requires:**

- `role`: Semantic role (see §3.4)
- `label`: Human-readable label

**Additional fields:**

- `id`: The ID of the corresponding `<g>` element (required for explicit concepts, omitted for implicit)
- `nsmPrime` (optional): Associated NSM prime
- `implicit` (optional, default `false`): Whether this concept is abstract/not visually represented
- `performedBy` (optional): For implicit Actions, the ID of the Agent performing the action
- `note` (optional): Clarifying note about representation or relationships

**See §3.3.4.1 for detailed guidance on explicit vs implicit concepts.**

##### 3.3.4.1 Explicit vs Implicit Concepts

Concepts in the metadata may be **explicit** or **implicit**, depending on whether they have a direct visual representation.

###### Explicit Concepts

Explicit concepts are those with a corresponding SVG `<g>` element. They have a direct visual representation in the pictogram.

- **Must have** an `id` field matching the SVG group's ID
- **Must have** a corresponding `<g role="group">` element in the SVG
- Typically include: Agent, Patient, Instrument, Location, Theme, and sometimes Action

Example:

```json
{
  "id": "g-person",
  "role": "Agent",
  "label": "Person making the bed",
  "nsmPrime": "SOMEONE"
}
```

###### Implicit Concepts

Implicit concepts are abstract notions that do not have a separate visual element. They are typically **Actions** that are performed by an Agent through posture, gesture, or spatial relationship.

- **Must have** `"implicit": true`
- **Must not** have an `id` field (or should omit it)
- **Should have** `performedBy` field indicating which explicit concept executes the action
- Typically include: Action (when performed through body language rather than shown separately)

Example:

```json
{
  "role": "Action",
  "label": "Making (implicit action performed by Agent)",
  "nsmPrime": "DO",
  "implicit": true,
  "performedBy": "g-person",
  "note": "Action is not a separate visual element; it is executed by the Agent"
}
```

###### When to Use Implicit Actions

Use implicit Actions when:

1. The action is inherent in the Agent's posture or gesture
2. The action would be redundant or visually cluttered if shown separately
3. The spatial relationship between Agent and Patient conveys the action
4. The Agent's body parts (arms, legs, hands) are positioned to indicate the action

Example scenario: "Make the bed"

- **Explicit Agent** (`g-person`): Visual representation of the person
- **Implicit Action** (making): Conveyed through the person's arm reaching towards the bed
- **Explicit Patient** (`g-bed`): Visual representation of the bed

###### When to Use Explicit Actions

Use explicit Actions (with their own `<g>` element) when:

1. The action has a visual indicator separate from the Agent (e.g., motion lines, arrows)
2. The action occurs between entities without a clear Agent
3. The action itself is the primary focus and needs visual emphasis

###### DOM Structure for Implicit Actions

When an Action is implicit, the Agent's SVG group should contain all body parts, including those that convey the action:

```xml
<g id="g-person" role="group" data-concept="Agent" data-action="making">
  <circle id="head" />
  <path id="arm" />  <!-- Conveys the action through position -->
  <path id="body" />
</g>
```

Note the `data-action` attribute on the Agent, which semantically links it to the implicit Action concept.

#### 3.3.5 `accessibility`

Accessibility descriptions.

**Required subfields:**
- `cognitiveDescription`: Simple, clear description for cognitive accessibility
- `visualDescription`: Detailed description for screen readers

#### 3.3.6 `provenance`

Attribution and versioning.

**Required subfields:**
- `generator`: Name and version of the generative model
- `generatedAt`: ISO 8601 timestamp

**Optional subfields:**
- `sourceDataset`: Training data reference
- `licence`: Licence identifier (e.g., `"CC BY 4.0"`)

#### 3.3.7 `vcsci`

Visual-Cognitive-Semantic Clarity Index (human validation).

**Required subfields:**
- `validated`: Boolean indicating validation status
- `validatedAt`: ISO 8601 timestamp

**Optional subfields:**
- `validator`: Validator identifier
- `clarityScore`: Score from 1 (ambiguous) to 5 (crystal clear)
- `comments`: Validator feedback
- `revisionHistory`: Array of previous revisions

### 3.4 Semantic Roles

The following roles are defined for the `concepts[].role` field:

| Role | Definition | Example |
|------|------------|---------|
| **Agent** | The entity performing the action | "I" in "I make the bed" |
| **Patient** | The entity undergoing the action | "the bed" in "I make the bed" |
| **Action** | The action or event | "making" in "I make the bed" |
| **Instrument** | Tool used to perform the action | "a broom" in "I sweep with a broom" |
| **Location** | Place where the action occurs | "the kitchen" in "I cook in the kitchen" |
| **Attribute** | Quality or property | "happy" in "I am happy" |
| **Experiencer** | Entity experiencing a state | "I" in "I feel cold" |
| **Beneficiary** | Entity benefiting from the action | "you" in "I give you water" |
| **Theme** | Entity being located or described | "the book" in "The book is on the table" |
| **Goal** | Destination or target | "home" in "I go home" |
| **Source** | Origin or starting point | "school" in "I come from school" |

---

## 4. DOM Hierarchy and Semantic Groups

### 4.1 Grouping Principle

**Every distinct semantic concept must be enclosed in a `<g>` element.**

### 4.2 Required Attributes

Each semantic group **must** include:

```xml
<g
  id="concept-id"
  role="group"
  tabindex="0"
  data-concept="SemanticRole"
  aria-label="Human-readable description">
  <!-- Visual primitives -->
</g>
```

**Attribute specifications:**

- `id`: Must match the `concepts[].id` in the metadata block
- `role="group"`: ARIA role for assistive technologies
- `tabindex="0"`: Enables keyboard navigation
- `data-concept`: The semantic role (e.g., `"Agent"`, `"Patient"`)
- `aria-label`: Accessible name for screen readers

### 4.3 Nested Groups

Groups may be nested for complex hierarchies, but each semantic concept from the metadata **must** have a corresponding top-level group.

### 4.4 Visual Primitives

Within groups, use standard SVG primitives:

- `<path>` — Complex shapes
- `<circle>`, `<ellipse>` — Circular forms
- `<rect>` — Rectangular forms
- `<line>`, `<polyline>`, `<polygon>` — Lines and polygons

**All primitives must use the class-based styling system (§5).**

---

## 5. The Dual-Class Styling System

### 5.1 Rationale

The dual-class system (`.f` for foreground, `.k` for key/contrast) ensures:

1. **Semantic differentiation**: Key elements are visually distinct
2. **Accessibility**: High-contrast elements aid users with low vision
3. **Platform independence**: Styles are embedded, not external

### 5.2 Class Definitions

#### 5.2.1 Foreground Classes (`.f`)

Used for the majority of visual elements.

- `.f`: Standard fill and stroke
- `.f-fill`: Fill only, no stroke
- `.f-stroke`: Stroke only, no fill

**Base properties:**
```css
.f {
  fill: #333333;
  stroke: #333333;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}
```

#### 5.2.2 Key/Contrast Classes (`.k`)

Reserved for semantically critical elements (e.g., Agent faces, Action indicators).

- `.k`: High-contrast fill and stroke
- `.k-fill`: High-contrast fill only
- `.k-stroke`: High-contrast stroke only

**Base properties:**
```css
.k {
  fill: #000000;
  stroke: #000000;
  stroke-width: 3;
  stroke-linecap: round;
  stroke-linejoin: round;
}
```

### 5.3 Embedded Stylesheet

The CSS must be embedded in a `<style>` block within `<defs>`:

```xml
<defs>
  <style type="text/css">
    /* Copy from schemas/styles.css */
  </style>
</defs>
```

### 5.4 Accessibility Media Queries

The stylesheet **must** include:

- `@media (prefers-contrast: high)` — Enhanced contrast for users who need it
- `@media (forced-colors: active)` — Compatibility with Windows High Contrast Mode

See [`../schemas/styles.css`](../schemas/styles.css) for the canonical implementation.

---

## 6. Accessibility Requirements

### 6.1 Semantic HTML within SVG

- `<title>`: The utterance or brief description
- `<desc>`: Detailed visual description
- `aria-labelledby`: Must reference both `title` and `desc`

### 6.2 Keyboard Navigation

- All semantic groups must have `tabindex="0"`
- Focus states should be visually indicated (see §5.3)

### 6.3 Screen Reader Compatibility

- Use `role="img"` on the root `<svg>`
- Use `role="group"` on semantic groups
- Provide meaningful `aria-label` attributes
- Use `aria-hidden="true"` for purely decorative groups

### 6.4 Cognitive Accessibility

- **Simplicity**: Minimise visual complexity
- **Consistency**: Use predictable spatial arrangements (e.g., Agent on left, Patient on right)
- **Semantic clarity**: Ensure the DOM structure mirrors the linguistic structure

---

## 7. Validation

### 7.1 Automated Validation

Use the provided tool:

```bash
python tools/validator.py your-pictogram.svg
```

### 7.2 Manual Validation Checklist

- [ ] XML is well-formed
- [ ] Metadata block validates against `metadata.schema.json`
- [ ] All `concepts[].id` values correspond to existing `<g>` elements
- [ ] All semantic groups have required attributes
- [ ] Embedded stylesheet includes accessibility media queries
- [ ] Visual rendering is clear in both standard and high-contrast modes

---

## 8. Extensions and Future Versions

### 8.1 Versioning

This specification follows semantic versioning. Breaking changes will increment the major version.

### 8.2 Extensions

Implementations may add custom metadata fields under `metadata.extensions`. These fields must not conflict with required fields.

---

## 9. References

- **NSM Theory**: Wierzbicka, A. (1996). *Semantics: Primes and Universals*
- **ARIA Specification**: [W3C WAI-ARIA 1.2](https://www.w3.org/TR/wai-aria-1.2/)
- **SVG Accessibility**: [W3C SVG Accessibility Features](https://www.w3.org/TR/SVG2/access.html)
- **Cognitive Accessibility**: [W3C COGA](https://www.w3.org/WAI/cognitive/)

---

## Appendix A: Example Implementation

See [`../examples/canonical-bed.svg`](../examples/canonical-bed.svg) for a complete, conformant implementation demonstrating all requirements.

---

**Document History:**

- 2026-01-27: Initial version 1.0.0
