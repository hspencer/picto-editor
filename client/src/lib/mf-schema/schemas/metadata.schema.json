{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mediafranca.org/schemas/svg-metadata.schema.json",
  "title": "MediaFranca SVG Metadata Schema",
  "description": "Formal schema for the <metadata> block within MediaFranca SVG pictograms. Enforces the Single Source of Truth (SSoT) principle by requiring NLU analysis, semantic role mappings, and human validation data.",
  "type": "object",
  "required": ["utterance", "nsm", "concepts", "provenance", "version"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version following semantic versioning (e.g., '1.0.0').",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "utterance": {
      "type": "string",
      "description": "The original communicative intent expressed by the user in natural language.",
      "minLength": 1,
      "examples": ["I am making the bed", "She needs water"]
    },
    "nsm": {
      "type": "object",
      "description": "Natural Semantic Metalanguage decomposition using semantic primes.",
      "required": ["primes", "gloss"],
      "properties": {
        "primes": {
          "type": "array",
          "description": "Array of NSM semantic primes identified in the utterance.",
          "items": {
            "type": "string",
            "enum": [
              "I", "YOU", "SOMEONE", "SOMETHING", "PEOPLE", "BODY",
              "THIS", "THE SAME", "OTHER",
              "ONE", "TWO", "SOME", "ALL", "MUCH", "LITTLE",
              "GOOD", "BAD",
              "BIG", "SMALL",
              "KNOW", "THINK", "WANT", "FEEL", "SEE", "HEAR",
              "SAY", "WORDS", "TRUE",
              "DO", "HAPPEN", "MOVE", "TOUCH",
              "BE", "THERE IS", "HAVE", "BE PART OF",
              "LIVE", "DIE",
              "WHEN", "TIME", "NOW", "BEFORE", "AFTER", "A LONG TIME", "A SHORT TIME", "FOR SOME TIME", "MOMENT",
              "WHERE", "PLACE", "HERE", "ABOVE", "BELOW", "FAR", "NEAR", "SIDE", "INSIDE",
              "NOT", "MAYBE", "CAN", "BECAUSE", "IF",
              "VERY", "MORE",
              "LIKE", "WAY"
            ]
          },
          "minItems": 1
        },
        "gloss": {
          "type": "string",
          "description": "Human-readable NSM gloss explaining the decomposition.",
          "minLength": 1,
          "examples": ["I DO something to SOMETHING in PLACE"]
        }
      },
      "additionalProperties": false
    },
    "concepts": {
      "type": "array",
      "description": "Semantic concepts mapped to SVG group elements, defining linguistic roles. Concepts may be explicit (with corresponding SVG groups) or implicit (abstract concepts performed by other entities).",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["role", "label"],
        "properties": {
          "id": {
            "type": "string",
            "description": "The ID of the corresponding SVG <g> element. Required for explicit concepts, omitted for implicit concepts.",
            "pattern": "^[a-z][a-z0-9-]*$",
            "examples": ["person-agent", "bed-patient", "action-making"]
          },
          "role": {
            "type": "string",
            "description": "The semantic role of this concept within the communicative act.",
            "enum": [
              "Agent",
              "Patient",
              "Action",
              "Instrument",
              "Location",
              "Attribute",
              "Experiencer",
              "Beneficiary",
              "Theme",
              "Goal",
              "Source"
            ]
          },
          "label": {
            "type": "string",
            "description": "Human-readable label for this concept.",
            "minLength": 1,
            "examples": ["Person making the bed", "The bed being made", "Making action"]
          },
          "nsmPrime": {
            "type": "string",
            "description": "Optional link to the NSM prime most closely associated with this concept.",
            "examples": ["I", "SOMETHING", "DO"]
          },
          "implicit": {
            "type": "boolean",
            "description": "Whether this concept is implicit (not visually represented as a separate element). Typically true for Action concepts performed by an Agent.",
            "default": false
          },
          "performedBy": {
            "type": "string",
            "description": "For implicit Action concepts: the ID of the SVG group that performs this action (typically an Agent).",
            "pattern": "^[a-z][a-z0-9-]*$",
            "examples": ["g-person", "g-agent"]
          },
          "note": {
            "type": "string",
            "description": "Optional clarifying note about this concept's representation or relationship to other concepts.",
            "examples": ["Action is performed through body posture", "Patient is partially visible"]
          }
        },
        "additionalProperties": false
      }
    },
    "accessibility": {
      "type": "object",
      "description": "Accessibility descriptions for assistive technologies.",
      "required": ["cognitiveDescription", "visualDescription"],
      "properties": {
        "cognitiveDescription": {
          "type": "string",
          "description": "Description optimised for cognitive accessibility, using simple language.",
          "minLength": 1,
          "examples": ["A person is making a bed"]
        },
        "visualDescription": {
          "type": "string",
          "description": "Detailed visual description for screen readers.",
          "minLength": 1,
          "examples": ["A simplified figure stands beside a rectangular bed with a pillow, arranging a blanket"]
        }
      },
      "additionalProperties": false
    },
    "provenance": {
      "type": "object",
      "description": "Attribution and versioning information for the pictogram generation.",
      "required": ["generator", "generatedAt"],
      "properties": {
        "generator": {
          "type": "string",
          "description": "Name and version of the generative model (e.g., 'PictoNet v2.1').",
          "minLength": 1
        },
        "generatedAt": {
          "type": "string",
          "description": "ISO 8601 timestamp of generation.",
          "format": "date-time"
        },
        "sourceDataset": {
          "type": "string",
          "description": "Optional reference to the training dataset or icon library.",
          "examples": ["ARASAAC", "Mulberry Symbols", "PictoNet-Synthetic-v1"]
        },
        "licence": {
          "type": "string",
          "description": "Licence under which this pictogram is released.",
          "examples": ["CC BY 4.0", "CC BY-SA 4.0"]
        }
      },
      "additionalProperties": false
    },
    "vcsci": {
      "type": "object",
      "description": "Visual-Cognitive-Semantic Clarity Index: human-in-the-loop validation data.",
      "required": ["validated", "validatedAt"],
      "properties": {
        "validated": {
          "type": "boolean",
          "description": "Whether this pictogram has passed human validation."
        },
        "validatedAt": {
          "type": "string",
          "description": "ISO 8601 timestamp of validation.",
          "format": "date-time"
        },
        "validator": {
          "type": "string",
          "description": "Identifier for the human validator (e.g., initials, UUID).",
          "examples": ["JD", "validator-a3f2"]
        },
        "clarityScore": {
          "type": "number",
          "description": "Clarity score from 1 (ambiguous) to 5 (crystal clear).",
          "minimum": 1,
          "maximum": 5
        },
        "comments": {
          "type": "string",
          "description": "Optional feedback from the validator.",
          "examples": ["Agent figure could be larger for better recognition"]
        },
        "revisionHistory": {
          "type": "array",
          "description": "Record of previous validation attempts and revisions.",
          "items": {
            "type": "object",
            "required": ["date", "change"],
            "properties": {
              "date": {
                "type": "string",
                "format": "date-time"
              },
              "change": {
                "type": "string",
                "description": "Description of what was changed.",
                "examples": ["Increased contrast on Agent figure", "Repositioned Patient element"]
              },
              "validator": {
                "type": "string"
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "extensions": {
      "type": "object",
      "description": "Optional namespace for implementation-specific metadata extensions.",
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
